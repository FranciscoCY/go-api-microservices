# go-grpc-crud

Microservicio en **Go** que implementa un **CRUD simple** con **PostgreSQL** utilizando **gRPC** como protocolo de comunicaciÃ³n.  
Incluye configuraciÃ³n parametrizada, soporte para contenerizaciÃ³n con Docker, migraciones de base de datos con Flyway, y estÃ¡ diseÃ±ado pensando en despliegues en Kubernetes.

---

## ğŸš€ TecnologÃ­as utilizadas

- **Go 1.22+**
- **gRPC**
- **Protocol Buffers (protoc)**
- **GORM** (ORM para Go)
- **PostgreSQL**
- **Viper** (manejo de configuraciÃ³n)
- **Flyway** (migraciones de base de datos)
- **Docker / Docker Compose**
- **Kubernetes (opcional, para despliegue futuro)**
- **Resiliencia** con patrones como timeouts, retries y circuit breakers.

---

## ğŸ“‚ Estructura del proyecto

```bash
go-grpc-crud/
â”œâ”€â”€ cmd/                # entrypoints (main.go)
â”œâ”€â”€ config/             # configuraciÃ³n YAML (config.yaml, config.example.yaml)
â”œâ”€â”€ migrations/                 # migraciones (Flyway)
â”œâ”€â”€ internal/           
â”‚   â”œâ”€â”€ config/         # carga de configuraciÃ³n con Viper
â”‚   â”œâ”€â”€ db/             # conexiÃ³n a la base de datos
â”‚   â”œâ”€â”€ model/          # modelos GORM
â”‚   â”œâ”€â”€ repository/     # capa de acceso a datos
â”‚   â”œâ”€â”€ service/        # lÃ³gica de negocio + implementaciÃ³n gRPC
â”œâ”€â”€ proto/              # archivos .proto y .pb.go generados
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ README.md
```

## âš™ï¸ ConfiguraciÃ³n

El proyecto utiliza Viper para leer la configuraciÃ³n desde un archivo config.yaml o variables de entorno.
Ejemplo de config/config.yaml:

```yaml
database:
  host: localhost
  port: 5432
  user: postgres
  password: postgres
  name: mydb
  sslmode: disable
```
No se debe versionar este archivo con credenciales reales.
En su lugar, subir config/config.example.yaml con valores dummy.

## ğŸ—„ï¸ Migraciones de base de datos

Se utiliza Flyway para manejar las migraciones de PostgreSQL.

Estructura de migraciones (db/migrations):

```bash
migrations/
â”œâ”€â”€ V1__init.sql
â”œâ”€â”€ V2__add_users_table.sql
```

Ejemplo de comando con Docker Compose:
```bash
docker-compose run --rm flyway migrate
```

## ğŸ› ï¸ GeneraciÃ³n de cÃ³digo gRPC
#### Nota: Para este caso se debe de tener protoc como CLI, en el caso no se tenga, instalarlo desde "Chocolate" con el siguiente comando
```bash
choco install protoc
```

Si modificas los archivos .proto, puedes regenerar los stubs ejecutando:

```bash
protoc --go_out=. --go-grpc_out=. proto/user.proto
```
En el repo se versionan tanto los .proto como los .pb.go generados para evitar depender de que cada dev tenga instalado protoc.

## ğŸ³ ContenerizaciÃ³n
### Dockerfile

El proyecto cuenta con un Dockerfile multistage para construir la aplicaciÃ³n en Go y ejecutarla en Alpine.

### Docker Compose

Archivo docker-compose.yml con servicios:

- db â†’ PostgreSQL
- app â†’ microservicio Go
- flyway â†’ contenedor de migraciones

Ejemplo:
```bash
docker-compose up --build
```

## â–¶ï¸ EjecuciÃ³n local

Instalar dependencias:
```bash
go mod tidy
```

Cargar configuraciÃ³n:

Crear archivo config/config.yaml basado en config/config.yaml.

Levantar PostgreSQL con Docker Compose:
```bash
docker-compose up -d db
```

Aplicar migraciones:
```bash
docker-compose run --rm flyway migrate
```

Ejecutar el microservicio:
```bash
go run cmd/main.go
```

El servidor gRPC estarÃ¡ disponible en localhost:50051.

## ğŸ§ª Pruebas con Postman

Puedes probar el servicio con: 
- Enter URL: localhost:50051
- Services definition: Cargar el archivo /proto/user.proto